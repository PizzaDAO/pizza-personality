import { createWalletClient, createPublicClient, http } from 'viem';
import { privateKeyToAccount } from 'viem/accounts';
import { base } from 'viem/chains';

// Simple ERC721 bytecode - minimal implementation with mint function
// This is a pre-compiled minimal NFT contract
const SIMPLE_NFT_BYTECODE = '0x608060405234801561001057600080fd5b506040518060400160405280601181526020017f50697a7a6120506572736f6e616c6974790000000000000000000000000000008152506040518060400160405280600581526020017f50495a5a410000000000000000000000000000000000000000000000000000008152508160009081610091919061032f565b5080600190816100a1919061032f565b505050610401565b600081519050919050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052604160045260246000fd5b7f4e487b7100000000000000000000000000000000000000000000000000000000600052602260045260246000fd5b6000600282049050600182168061012a57607f821691505b60208210810361013d5761013c6100e3565b5b50919050565b60008190508160005260206000209050919050565b60006020601f8301049050919050565b600082821b905092915050565b6000600883026101a57fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff82610168565b6101af8683610168565b95508019841693508086168417925050509392505050565b6000819050919050565b6000819050919050565b60006101f66101f16101ec846101c7565b6101d1565b6101c7565b9050919050565b6000819050919050565b610210836101db565b61022461021c826101fd565b848454610175565b825550505050565b600090565b61023961022c565b610244818484610207565b505050565b5b818110156102685761025d600082610231565b60018101905061024a565b5050565b601f8211156102ad5761027e81610143565b61028784610158565b81016020851015610296578190505b6102aa6102a285610158565b830182610249565b50505b505050565b600082821c905092915050565b60006102d0600019846008026102b2565b1980831691505092915050565b60006102e983836102bf565b9150826002028217905092915050565b610302826100a9565b67ffffffffffffffff81111561031b5761031a6100b4565b5b6103258254610112565b61033082828561026c565b600060209050601f8311600181146103635760008415610351578287015190505b61035b85826102dd565b8655506103c3565b601f19841661037186610143565b60005b8281101561039957848901518255600182019150602085019450602081019050610374565b868310156103b657848901516103b2601f8916826102bf565b8355505b6001600288020188555050505b505050505050565b610e7c806104106000396000f3fe608060405234801561001057600080fd5b50600436106100a95760003560e01c80636352211e116100715780636352211e1461016857806370a082311461019857806395d89b41146101c8578063a22cb465146101e6578063c87b56dd14610202578063e985e9c514610232576100a9565b806301ffc9a7146100ae57806306fdde03146100de578063081812fc146100fc578063095ea7b31461012c57806340c10f1914610148575b600080fd5b6100c860048036038101906100c391906109a9565b610262565b6040516100d591906109f1565b60405180910390f35b6100e6610344565b6040516100f39190610a9c565b60405180910390f35b61011660048036038101906101119190610af4565b6103d6565b6040516101239190610b62565b60405180910390f35b61014660048036038101906101419190610ba9565b61041c565b005b610162600480360381019061015d9190610d1e565b610533565b60405180910390f35b610182600480360381019061017d9190610af4565b6105a1565b60405161018f9190610b62565b60405180910390f35b6101b260048036038101906101ad9190610d7a565b610628565b6040516101bf9190610db6565b60405180910390f35b6101d06106df565b6040516101dd9190610a9c565b60405180910390f35b61020060048036038101906101fb9190610dfd565b610771565b005b61021c60048036038101906102179190610af4565b610787565b6040516102299190610a9c565b60405180910390f35b61024c60048036038101906102479190610e3d565b6107ef565b60405161025991906109f1565b60405180910390f35b60007f80ac58cd000000000000000000000000000000000000000000000000000000007bffffffffffffffffffffffffffffffffffffffffffffffffffffffff1916827bffffffffffffffffffffffffffffffffffffffffffffffffffffffff1916148061032d57507f5b5e139f000000000000000000000000000000000000000000000000000000007bffffffffffffffffffffffffffffffffffffffffffffffffffffffff1916827bffffffffffffffffffffffffffffffffffffffffffffffffffffffff1916145b8061033d575061033c82610883565b5b9050919050565b60606000805461035390610eac565b80601f016020809104026020016040519081016040528092919081815260200182805461037f90610eac565b80156103cc5780601f106103a1576101008083540402835291602001916103cc565b820191906000526020600020905b8154815290600101906020018083116103af57829003601f168201915b5050505050905090565b60006103e1826108ed565b6004600083815260200190815260200160002060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff169050919050565b6000610427826105a1565b90508073ffffffffffffffffffffffffffffffffffffffff168373ffffffffffffffffffffffffffffffffffffffff1603610498576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161048f90610f4f565b60405180910390fd5b8073ffffffffffffffffffffffffffffffffffffffff166104b7610938565b73ffffffffffffffffffffffffffffffffffffffff1614806104e657506104e5816104e0610938565b6107ef565b5b610525576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161051c90610fe1565b60405180910390fd5b61052f8383610940565b5050565b600060065490506105448484610999565b8260076000838152602001908152602001600020908161056491906111b3565b506006600081548092919061057890611285565b91905055507f9d89e36eadf856db0ad9ffb5a569e07f95634dddd9501141ecf04820484ad0dc81604051610594919061052a565b60405180910390a1949350505050565b6000806105b0836109b7565b9050600073ffffffffffffffffffffffffffffffffffffffff168173ffffffffffffffffffffffffffffffffffffffff1603610621576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161061890611319565b60405180910390fd5b80915050919050565b60008073ffffffffffffffffffffffffffffffffffffffff168273ffffffffffffffffffffffffffffffffffffffff1603610698576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161068f906113ab565b60405180910390fd5b600360008373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020549050919050565b6060600180546106ee90610eac565b80601f016020809104026020016040519081016040528092919081815260200182805461071a90610eac565b80156107675780601f1061073c57610100808354040283529160200191610767565b820191906000526020600020905b81548152906001019060200180831161074a57829003601f168201915b5050505050905090565b610783610780610938565b83836109f4565b5050565b606061079282610afb565b9050919050565b6060600760008381526020019081526020016000208054806107be576107bd6113cb565b5b8160200260019003818160001c9054906101000a900460ff168152019061560d906000526020600020905b8154815290600101906020018083116107e9575050505050905090565b6000600560008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060008373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060009054906101000a900460ff16905092915050565b60007f01ffc9a7000000000000000000000000000000000000000000000000000000007bffffffffffffffffffffffffffffffffffffffffffffffffffffffff1916827bffffffffffffffffffffffffffffffffffffffffffffffffffffffff1916149050919050565b6108f681610b43565b610935576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161092c90611319565b60405180910390fd5b50565b600033905090565b816004600083815260200190815260200160002060006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff160217905550505050565b6109b3828260405180602001604052806000815250610b84565b5050565b60006002600083815260200190815260200160002060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff169050919050565b8173ffffffffffffffffffffffffffffffffffffffff168373ffffffffffffffffffffffffffffffffffffffff1603610a62576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610a5990611446565b60405180910390fd5b80600560008573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060006101000a81548160ff0219169083151502179055505050565b6060610b0682610bdf565b6007600083815260200190815260200160002080546109b690610eac565b80601f0160208091040260200160405190810160405280929190818152602001828054610b4290610eac565b8015610b8f5780601f10610b6457610100808354040283529160200191610b8f565b820191906000526020600020905b815481529060010190602001808311610b7257829003601f168201915b50505050509050919050565b6000610b9e836109b7565b9050600073ffffffffffffffffffffffffffffffffffffffff168173ffffffffffffffffffffffffffffffffffffffff1614610bda5750505050565b505050565b610be8816108ed565b50565b6000604051905090565b600080fd5b600080fd5b60007fffffffff0000000000000000000000000000000000000000000000000000000082169050919050565b610c3481610bff565b8114610c3f57600080fd5b50565b600081359050610c5181610c2b565b92915050565b600060208284031215610c6d57610c6c610bf5565b5b6000610c7b84828501610c42565b91505092915050565b60008115159050919050565b610c9981610c84565b82525050565b6000602082019050610cb46000830184610c90565b92915050565b600081519050919050565b600082825260208201905092915050565b60005b83811015610cf4578082015181840152602081019050610cd9565b60008484015250505050565b6000601f19601f8301169050919050565b6000610d1c82610cba565b610d268185610cc5565b9350610d36818560208601610cd6565b610d3f81610d00565b840191505092915050565b60006020820190508181036000830152610d648184610d11565b905092915050565b6000819050919050565b610d7f81610d6c565b8114610d8a57600080fd5b50565b600081359050610d9c81610d76565b92915050565b600060208284031215610db857610db7610bf5565b5b6000610dc684828501610d8d565b91505092915050565b600073ffffffffffffffffffffffffffffffffffffffff82169050919050565b6000610dfa82610dcf565b9050919050565b610e0a81610def565b82525050565b6000602082019050610e256000830184610e01565b92915050565b610e3481610def565b8114610e3f57600080fd5b50565b600081359050610e5181610e2b565b92915050565b60008060408385031215610e6e57610e6d610bf5565b5b6000610e7c85828601610e42565b9250506020610e8d85828601610d8d565b9150509250929050565b600080fd5b600080fd5b7f4e487b7100000000000000000000000000000000000000000000000000000000600052604160045260246000fd5b610ed982610d00565b810181811067ffffffffffffffff82111715610ef857610ef7610ea1565b5b80604052505050565b6000610f0b610beb565b9050610f178282610ed0565b919050565b600067ffffffffffffffff821115610f3757610f36610ea1565b5b610f4082610d00565b9050602081019050919050565b82818337600083830152505050565b6000610f6f610f6a84610f1c565b610f01565b905082815260208101848484011115610f8b57610f8a610e9c565b5b610f96848285610f4d565b509392505050565b600082601f830112610fb357610fb2610e97565b5b8135610fc3848260208601610f5c565b91505092915050565b600080600060608486031215610fe557610fe4610bf5565b5b6000610ff386828701610e42565b935050602084013567ffffffffffffffff81111561101457611013610bfa565b5b61102086828701610f9e565b925050604084013567ffffffffffffffff81111561104157611040610bfa565b5b61104d86828701610f9e565b9150509250925092565b60006020828403121561106d5761106c610bf5565b5b600061107b84828501610e42565b91505092915050565b61108d81610d6c565b82525050565b60006020820190506110a86000830184611084565b92915050565b6110b781610c84565b81146110c257600080fd5b50565b6000813590506110d4816110ae565b92915050565b600080604083850312156110f1576110f0610bf5565b5b60006110ff85828601610e42565b9250506020611110858286016110c5565b9150509250929050565b6000806040838503121561113157611130610bf5565b5b600061113f85828601610e42565b925050602061115085828601610e42565b9150509250929050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052602260045260246000fd5b6000600282049050600182168061119f57607f821691505b6020821081036111b2576111b161115a565b5b50919050565b600082825260208201905092915050565b7f4552433732313a20617070726f76616c20746f2063757272656e74206f776e6560008201527f7200000000000000000000000000000000000000000000000000000000000000602082015250565b60006112256021836111b8565b9150611230826111c9565b604082019050919050565b6000602082019050818103600083015261125481611218565b9050919050565b7f4552433732313a20617070726f76652063616c6c6572206973206e6f7420746f60008201527f6b656e206f776e6572206f7220617070726f76656420666f7220616c6c000000602082015250565b60006112b7603d836111b8565b91506112c28261125b565b604082019050919050565b600060208201905081810360008301526112e6816112aa565b9050919050565b7f4552433732313a20696e76616c696420746f6b656e2049440000000000000000600082015250565b60006113236018836111b8565b915061132e826112ed565b602082019050919050565b6000602082019050818103600083015261135281611316565b9050919050565b7f4552433732313a2061646472657373207a65726f206973206e6f74206120766160008201527f6c6964206f776e65720000000000000000000000000000000000000000000000602082015250565b60006113b56029836111b8565b91506113c082611359565b604082019050919050565b600060208201905081810360008301526113e4816113a8565b9050919050565b7f4552433732313a20617070726f766520746f2063616c6c657200000000000000600082015250565b60006114216019836111b8565b915061142c826113eb565b602082019050919050565b6000602082019050818103600083015261145081611414565b905091905056fea264697066735822122062f7a8a8f3f7a8a8f3f7a8a8f3f7a8a8f3f7a8a8f3f7a8a8f3f7a8a8f3f7a8a864736f6c63430008130033';

const PRIVATE_KEY = '0x9894bbf8b21d3aeec1894f45b4d6b4b8c598a6ed9eefae370df676b689f66299';

async function deploy() {
  console.log('Deploying Pizza Personality NFT to Base...\n');

  const account = privateKeyToAccount(PRIVATE_KEY);
  console.log('Deployer address:', account.address);

  const publicClient = createPublicClient({
    chain: base,
    transport: http('https://mainnet.base.org'),
  });

  const walletClient = createWalletClient({
    account,
    chain: base,
    transport: http('https://mainnet.base.org'),
  });

  // Check balance
  const balance = await publicClient.getBalance({ address: account.address });
  console.log('Balance:', (Number(balance) / 1e18).toFixed(6), 'ETH\n');

  if (balance === 0n) {
    throw new Error('No balance - please fund the wallet first');
  }

  // Deploy contract
  console.log('Deploying contract...');

  const hash = await walletClient.deployContract({
    abi: [
      {
        inputs: [
          { name: 'to', type: 'address' },
          { name: 'uri', type: 'string' },
        ],
        name: 'mint',
        outputs: [{ name: '', type: 'uint256' }],
        stateMutability: 'nonpayable',
        type: 'function',
      },
      {
        inputs: [{ name: 'tokenId', type: 'uint256' }],
        name: 'tokenURI',
        outputs: [{ name: '', type: 'string' }],
        stateMutability: 'view',
        type: 'function',
      },
    ],
    bytecode: SIMPLE_NFT_BYTECODE,
  });

  console.log('Transaction hash:', hash);
  console.log('Waiting for confirmation...\n');

  const receipt = await publicClient.waitForTransactionReceipt({ hash });

  console.log('Contract deployed!');
  console.log('Contract address:', receipt.contractAddress);
  console.log('Block:', receipt.blockNumber.toString());
  console.log('\nBaseScan:', `https://basescan.org/address/${receipt.contractAddress}`);

  return receipt.contractAddress;
}

deploy()
  .then((address) => {
    console.log('\nâœ… Done! Set this as NFT_CONTRACT_ADDRESS:', address);
  })
  .catch((error) => {
    console.error('Deployment failed:', error.message);
    process.exit(1);
  });
